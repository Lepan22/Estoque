<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Painel do Gerente</title>
    <!-- Link para o arquivo CSS externo -->
    <link rel="stylesheet" href="assets/style.css">

    <script type="module">
        import { initializeApp }     from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

        // --- Configura√ß√£o Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyBN-bmzgrlzjmrKMmuClZ8LVll-vJyx-aE",
            authDomain: "controleestoquelepan.firebaseapp.com",
            databaseURL: "https://controleestoquelepan-default-rtdb.firebaseio.com",
            projectId: "controleestoquelepan",
            storageBucket: "controleestoquelepan.appspot.com",
            messagingSenderId: "779860276544",
            appId: "1:779860276544:web:f45844571a8c0bab1576a5",
        };
        const app = initializeApp(firebaseConfig);
        const db  = getDatabase(app);

        // --- Token para habilitar edi√ß√£o ---
        const EDIT_TOKEN = "SEU_TOKEN_SECRETO";

        // Refer√™ncia ao tbody da tabela
        const tabelaBody = document.getElementById("eventos-tbody");
        const loadingRow = document.getElementById("loading-row");

        function carregarEventos() {
            const eventosRef = ref(db, "eventos");
            onValue(eventosRef, (snapshot) => {
                tabelaBody.innerHTML = ''; 
                loadingRow.style.display = 'none';

                if (!snapshot.exists()) {
                    tabelaBody.innerHTML = '<tr><td colspan="5">Nenhum evento encontrado.</td></tr>';
                    return;
                }

                const eventos = snapshot.val();
                const eventosArray = Object.entries(eventos)
                    .map(([id, evento]) => ({ id, ...evento }))
                    .sort((a, b) => new Date(b.data) - new Date(a.data));

                eventosArray.forEach(({ id, nome, data, responsavel, status }) => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td data-label="Nome">${nome || 'N/A'}</td>
                        <td data-label="Data">${data || 'N/A'}</td>
                        <td data-label="Respons√°vel">${responsavel || 'N/A'}</td>
                        <td data-label="Status">${status || 'aberto'}</td>
                        <td data-label="A√ß√µes">
                            <a href="form.html?id=${id}" class="botao">Ver Detalhes</a>
                            <a href="form.html?id=${id}&editKey=${EDIT_TOKEN}" class="botao editar">‚úèÔ∏è Editar</a>
                        </td>
                    `;
                    tabelaBody.appendChild(tr);
                });
            }, (error) => {
                console.error("Erro ao carregar eventos: ", error);
                loadingRow.style.display = 'none';
                tabelaBody.innerHTML = '<tr><td colspan="5">Erro ao carregar eventos.</td></tr>';
            });
        }

        document.addEventListener('DOMContentLoaded', carregarEventos);
    </script>
</head>
<body>
    <div class="container">
        <h1>Painel do Gerente</h1>
        <a href="assets/criar-evento.html" class="botao">‚ûï Criar Novo Evento</a>
        <a href="assets/produtos.html" class="botao-criar">üì¶ Cadastro de Produto</a>
        
        <table id="eventos-tabela">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Data</th>
                    <th>Respons√°vel</th>
                    <th>Status</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="eventos-tbody">
                <tr id="loading-row">
                    <td colspan="5">Carregando eventos...</td>
                </tr>
            </tbody>
        </table>
    </div> 
</body>
</html>
