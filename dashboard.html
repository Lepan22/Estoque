<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Novo Layout</title>
  <link rel="stylesheet" href="novo_style.css"> <!-- Certifique-se que o caminho para o CSS estÃ¡ correto -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Estilos adicionais podem ser colocados aqui ou no novo_style.css */
  </style>
</head>
<body>
  <div class="sidebar" id="sidebarMenu">
    <h2>LePan</h2>
    <ul>
      <li><a href="#" class="active">Dashboard</a></li>
      <li><a href="assets/relatorio.html">ðŸ“Š RelatÃ³rios</a></li>
      <li><a href="assets/produtos.html">ðŸ“¦ Produtos</a></li>
      <li><a href="lista_clientes.html">ðŸ‘¥ Clientes</a></li>
      <li><a href="evento.html">ðŸ“… Eventos</a></li>
    </ul>
  </div>

  <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>

  <div class="main-content">
    <div class="container-principal">
      <h1>Dashboard</h1>

      <!-- Container para os KPIs -->
      <div class="container-kpis-dashboard">
        <div class="card-kpi-dashboard">
          <h3 class="kpi-title">Clientes Ativos</h3>
          <p class="kpi-value">10</p>
        </div>
        <div class="card-kpi-dashboard">
          <h3 class="kpi-title">Receita do MÃªs</h3>
          <p class="kpi-value">R$ 13291,00</p>
        </div>
        <div class="card-kpi-dashboard">
          <h3 class="kpi-title">Lucro do MÃªs</h3>
          <p class="kpi-value">R$ 6067,22</p>
        </div>
        <div class="card-kpi-dashboard">
          <h3 class="kpi-title">Eventos no MÃªs</h3>
          <p class="kpi-value">6</p>
        </div>
      </div>

      <!-- Container para os GrÃ¡ficos -->
      <div class="container-charts-dashboard">
        <div class="chart-item-dashboard">
          <h3>Estimativa vs Venda Real (MÃªs a MÃªs)</h3>
          <canvas id="vendasChart"></canvas>
        </div>
        <div class="chart-item-dashboard">
          <h3>Lucro por MÃªs (Ãšltimos 6 meses)</h3>
          <canvas id="lucroChart"></canvas>
        </div>
        <div class="chart-item-dashboard">
          <h3>Perda por MÃªs (Ãšltimos 6 meses)</h3>
          <canvas id="perdaChart"></canvas>
        </div>
        <div class="chart-item-dashboard">
          <h3>Eventos por MÃªs (EvoluÃ§Ã£o)</h3>
          <canvas id="eventosEvolucaoChart"></canvas> <!-- ID alterado -->
        </div>
      </div>

    </div>
  </div>

  <script>
    function toggleSidebar() {
      document.getElementById("sidebarMenu").classList.toggle("active");
    }

    // FunÃ§Ã£o para buscar e processar dados de estimativa do Firebase
    async function carregarDadosEstimativa() {
      try {
        // Para testar localmente, vocÃª pode servir o arquivo firebase_estimativa_data.json
        // ou substituir pela URL real se o CORS estiver configurado no Firebase.
        // Por enquanto, vamos simular o fetch com os dados jÃ¡ obtidos.
        const dadosEstimativaFirebase = {"-OQK50IP7P24i4aDxVYd":{"categoria":"Venda Evento","data":"2025-05","valor":35000},"-OQK5K4tf-Z_X1cZgqwF":{"categoria":"Venda Evento","data":"2025-06","valor":30000},"-OQK5NRFH4z5Qb19qHLz":{"categoria":"Venda Evento","data":"2025-07","valor":15000},"-OQK5Q3NzUG1gQKePObM":{"categoria":"Venda Evento","data":"2025-08","valor":35000},"-OQK5TQsj1sPZ_w2r2Cy":{"categoria":"Venda Evento","data":"2025-09","valor":35000},"-OQK5W2V_7y3rgkeP4QB":{"categoria":"Venda Evento","data":"2025-10","valor":25000},"-OQK5YSc97UgZkMRDrQL":{"categoria":"Venda Evento","data":"2025-11","valor":35000},"-OQK5a9-CyhGKxGyE5ld":{"categoria":"Venda Evento","data":"2025-12","valor":30000}};
        
        const entradas = Object.values(dadosEstimativaFirebase);
        entradas.sort((a, b) => new Date(a.data) - new Date(b.data)); // Ordena por data

        const labels = entradas.map(e => e.data); // Formato YYYY-MM
        const valoresEstimativa = entradas.map(e => e.valor);
        
        return { labels, valoresEstimativa };
      } catch (error) {
        console.error("Erro ao carregar dados de estimativa:", error);
        return { labels: [], valoresEstimativa: [] };
      }
    }

    // Dados de exemplo para Venda Real Mensal (substitua pelos seus dados reais)
    // Certifique-se que a ordem e quantidade de meses correspondem aos dados de estimativa
    const dadosVendaRealMensalExemplo = {
        "2025-05": 13291, // Exemplo do KPI atual
        "2025-06": 28000,
        "2025-07": 16000,
        "2025-08": 33000,
        "2025-09": 36000,
        "2025-10": 23000,
        "2025-11": 37000,
        "2025-12": 29000
    };

    // Dados de exemplo para EvoluÃ§Ã£o de Eventos por MÃªs (substitua pelos seus dados reais)
    const dadosEventosEvolucaoExemplo = {
        labels: ["2025-01", "2025-02", "2025-03", "2025-04", "2025-05", "2025-06"],
        quantidades: [3, 5, 4, 7, 6, 8] // Quantidade de eventos por mÃªs
    };

    async function inicializarGraficos() {
      const { labels: labelsEstimativa, valoresEstimativa } = await carregarDadosEstimativa();
      
      // Mapear os valores de Venda Real para corresponder aos labels da Estimativa
      const valoresVendaReal = labelsEstimativa.map(label => dadosVendaRealMensalExemplo[label] || 0);

      // GrÃ¡fico de Vendas (Estimativa vs Venda Real MÃªs a MÃªs)
      const vendasCtx = document.getElementById("vendasChart").getContext("2d");
      new Chart(vendasCtx, {
        type: "bar",
        data: {
          labels: labelsEstimativa, // Labels dos meses da estimativa
          datasets: [
            { label: "Estimativa", data: valoresEstimativa, backgroundColor: "rgba(200, 200, 200, 0.7)", borderColor: "rgba(200, 200, 200, 1)", borderWidth: 1 },
            { label: "Venda Real (PDV)", data: valoresVendaReal, backgroundColor: "rgba(0, 123, 255, 0.7)", borderColor: "rgba(0, 123, 255, 1)", borderWidth: 1 }
          ]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });

      // GrÃ¡fico de Lucro (mantido como exemplo, ajuste conforme seus dados reais)
      const labelsMesesExemplo = ["Dez/24", "Jan/25", "Fev/25", "Mar/25", "Abr/25", "Mai/25"];
      const lucroCtx = document.getElementById("lucroChart").getContext("2d");
      new Chart(lucroCtx, {
        type: "line",
        data: {
          labels: labelsMesesExemplo,
          datasets: [{ label: "Lucro por MÃªs", data: [5000, 5500, 4800, 6200, 5800, 6067.22], borderColor: "green", fill: false, tension: 0.1 }]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });

      // GrÃ¡fico de Perda (mantido como exemplo, ajuste conforme seus dados reais)
      const perdaCtx = document.getElementById("perdaChart").getContext("2d");
      new Chart(perdaCtx, {
        type: "line",
        data: {
          labels: labelsMesesExemplo,
          datasets: [{ label: "Perda por MÃªs", data: [300, 200, 400, 150, 250, 100], borderColor: "red", fill: false, tension: 0.1 }]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });

      // GrÃ¡fico de EvoluÃ§Ã£o de Eventos por MÃªs
      const eventosEvolucaoCtx = document.getElementById("eventosEvolucaoChart").getContext("2d");
      new Chart(eventosEvolucaoCtx, {
        type: "bar", // Pode ser 'line' tambÃ©m
        data: {
          labels: dadosEventosEvolucaoExemplo.labels,
          datasets: [{ label: "Quantidade de Eventos", data: dadosEventosEvolucaoExemplo.quantidades, backgroundColor: "rgba(255, 159, 64, 0.7)", borderColor: "rgba(255, 159, 64, 1)", borderWidth: 1 }]
        },
        options: { scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } } // Garante que o eixo Y conte de 1 em 1
      });
    }

    // Inicializa os grÃ¡ficos quando a pÃ¡gina carregar
    document.addEventListener("DOMContentLoaded", inicializarGraficos);

  </script>
</body>
</html>

