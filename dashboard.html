<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Layout Ajustado e Dados Reais</title>
  <link rel="stylesheet" href="assets/novo_style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="sidebar" id="sidebarMenu">
    <h2>LePan</h2>
    <ul>
      <li><a href="#" class="active">Dashboard</a></li>
      <li><a href="assets/relatorio.html">ðŸ“Š RelatÃ³rios</a></li>
      <li><a href="assets/produtos.html">ðŸ“¦ Produtos</a></li>
      <li><a href="lista_clientes.html">ðŸ‘¥ Clientes</a></li>
      <li><a href="evento.html">ðŸ“… Eventos</a></li>
    </ul>
  </div>

  <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>

  <div class="main-content">
    <div class="container-principal">
      <h1>Dashboard</h1>

      <div class="container-kpis-dashboard">
        <div class="card-kpi-dashboard">
          <h3 class="kpi-title">Clientes Ativos</h3>
          <p class="kpi-value" id="kpiClientesAtivos">10</p> <!-- ID para possÃ­vel atualizaÃ§Ã£o dinÃ¢mica -->
        </div>
        <div class="card-kpi-dashboard">
          <h3 class="kpi-title">Receita do MÃªs</h3>
          <p class="kpi-value" id="kpiReceitaMes">R$ 13291,00</p> <!-- ID para possÃ­vel atualizaÃ§Ã£o dinÃ¢mica -->
        </div>
        <div class="card-kpi-dashboard">
          <h3 class="kpi-title">Lucro do MÃªs</h3>
          <p class="kpi-value" id="kpiLucroMes">R$ 6067,22</p> <!-- ID para possÃ­vel atualizaÃ§Ã£o dinÃ¢mica -->
        </div>
        <div class="card-kpi-dashboard">
          <h3 class="kpi-title">Eventos no MÃªs</h3>
          <p class="kpi-value" id="kpiEventosMes">6</p> <!-- ID para possÃ­vel atualizaÃ§Ã£o dinÃ¢mica -->
        </div>
      </div>

      <div class="container-charts-dashboard">
        <div class="chart-item-dashboard">
          <h3>Estimativa vs Venda Real (MÃªs a MÃªs)</h3>
          <canvas id="vendasChart"></canvas>
        </div>
        <div class="chart-item-dashboard">
          <h3>Lucro por MÃªs</h3>
          <canvas id="lucroChart"></canvas>
        </div>
        <div class="chart-item-dashboard">
          <h3>Perda por MÃªs</h3>
          <canvas id="perdaChart"></canvas>
        </div>
        <div class="chart-item-dashboard">
          <h3>Eventos por MÃªs (EvoluÃ§Ã£o)</h3>
          <canvas id="eventosEvolucaoChart"></canvas>
        </div>
      </div>

    </div>
  </div>

  <script>
    function toggleSidebar() {
      document.getElementById("sidebarMenu").classList.toggle("active");
    }

    async function carregarDadosEstimativaFirebase() {
      try {
        // SimulaÃ§Ã£o dos dados do Firebase como recebidos anteriormente
        const dadosEstimativaFirebase = {"-OQK50IP7P24i4aDxVYd":{"categoria":"Venda Evento","data":"2025-05","valor":35000},"-OQK5K4tf-Z_X1cZgqwF":{"categoria":"Venda Evento","data":"2025-06","valor":30000},"-OQK5NRFH4z5Qb19qHLz":{"categoria":"Venda Evento","data":"2025-07","valor":15000},"-OQK5Q3NzUG1gQKePObM":{"categoria":"Venda Evento","data":"2025-08","valor":35000},"-OQK5TQsj1sPZ_w2r2Cy":{"categoria":"Venda Evento","data":"2025-09","valor":35000},"-OQK5W2V_7y3rgkeP4QB":{"categoria":"Venda Evento","data":"2025-10","valor":25000},"-OQK5YSc97UgZkMRDrQL":{"categoria":"Venda Evento","data":"2025-11","valor":35000},"-OQK5a9-CyhGKxGyE5ld":{"categoria":"Venda Evento","data":"2025-12","valor":30000}};
        
        const entradas = Object.values(dadosEstimativaFirebase);
        entradas.sort((a, b) => new Date(a.data + '-01') - new Date(b.data + '-01')); // Ordena por data (YYYY-MM)

        const labels = entradas.map(e => e.data); 
        const valoresEstimativa = entradas.map(e => e.valor);
        return { labels, valoresEstimativa };
      } catch (error) {
        console.error("Erro ao carregar dados de estimativa do Firebase (simulado):", error);
        return { labels: [], valoresEstimativa: [] };
      }
    }

    // FunÃ§Ã£o para buscar dados reais - SUBSTITUA ESTA LÃ“GICA PELA SUA FONTE DE DADOS
    function obterDadosReaisVendaMensal(labelsEstimativa) {
      // Exemplo: Se vocÃª tiver um objeto com vendas reais por mÃªs (YYYY-MM)
      // const vendasReais = { "2025-05": 13291, "2025-06": 28000, ... };
      // return labelsEstimativa.map(label => vendasReais[label] || 0);
      console.warn(" obterDadosReaisVendaMensal(): Usando array de zeros. Substitua pela sua lÃ³gica de dados reais.");
      return new Array(labelsEstimativa.length).fill(0); // Retorna zeros se nÃ£o houver dados reais
    }

    function obterDadosReaisEventosMensal() {
      // Exemplo: { labels: ["2025-01", ...], quantidades: [3, ...] }
      console.warn("obterDadosReaisEventosMensal(): Usando dados vazios. Substitua pela sua lÃ³gica de dados reais.");
      return { labels: [], quantidades: [] };
    }

    function obterDadosReaisLucroMensal() {
      console.warn("obterDadosReaisLucroMensal(): Usando dados vazios. Substitua pela sua lÃ³gica de dados reais.");
      return { labels: [], valores: [] };
    }

    function obterDadosReaisPerdaMensal() {
      console.warn("obterDadosReaisPerdaMensal(): Usando dados vazios. Substitua pela sua lÃ³gica de dados reais.");
      return { labels: [], valores: [] };
    }

    async function inicializarGraficos() {
      const { labels: labelsEstimativa, valoresEstimativa } = await carregarDadosEstimativaFirebase();
      const valoresVendaReal = obterDadosReaisVendaMensal(labelsEstimativa);
      const dadosEventosReais = obterDadosReaisEventosMensal();
      const dadosLucroReais = obterDadosReaisLucroMensal();
      const dadosPerdaReais = obterDadosReaisPerdaMensal();

      // GrÃ¡fico de Vendas (Estimativa vs Venda Real MÃªs a MÃªs)
      const vendasCtx = document.getElementById("vendasChart").getContext("2d");
      new Chart(vendasCtx, {
        type: "bar",
        data: {
          labels: labelsEstimativa,
          datasets: [
            { label: "Estimativa (Firebase)", data: valoresEstimativa, backgroundColor: "rgba(200, 200, 200, 0.7)", borderColor: "rgba(200, 200, 200, 1)", borderWidth: 1 },
            { label: "Venda Real (PDV)", data: valoresVendaReal, backgroundColor: "rgba(0, 123, 255, 0.7)", borderColor: "rgba(0, 123, 255, 1)", borderWidth: 1 }
          ]
        },
        options: { scales: { y: { beginAtZero: true } }, responsive: true, maintainAspectRatio: false }
      });

      // GrÃ¡fico de Lucro
      const lucroCtx = document.getElementById("lucroChart").getContext("2d");
      new Chart(lucroCtx, {
        type: "line",
        data: {
          labels: dadosLucroReais.labels, // Usar labels dos dados reais
          datasets: [{ label: "Lucro por MÃªs", data: dadosLucroReais.valores, borderColor: "green", fill: false, tension: 0.1 }]
        },
        options: { scales: { y: { beginAtZero: true } }, responsive: true, maintainAspectRatio: false }
      });

      // GrÃ¡fico de Perda
      const perdaCtx = document.getElementById("perdaChart").getContext("2d");
      new Chart(perdaCtx, {
        type: "line",
        data: {
          labels: dadosPerdaReais.labels, // Usar labels dos dados reais
          datasets: [{ label: "Perda por MÃªs", data: dadosPerdaReais.valores, borderColor: "red", fill: false, tension: 0.1 }]
        },
        options: { scales: { y: { beginAtZero: true } }, responsive: true, maintainAspectRatio: false }
      });

      // GrÃ¡fico de EvoluÃ§Ã£o de Eventos por MÃªs
      const eventosEvolucaoCtx = document.getElementById("eventosEvolucaoChart").getContext("2d");
      new Chart(eventosEvolucaoCtx, {
        type: "bar",
        data: {
          labels: dadosEventosReais.labels, // Usar labels dos dados reais
          datasets: [{ label: "Quantidade de Eventos", data: dadosEventosReais.quantidades, backgroundColor: "rgba(255, 159, 64, 0.7)", borderColor: "rgba(255, 159, 64, 1)", borderWidth: 1 }]
        },
        options: { scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }, responsive: true, maintainAspectRatio: false }
      });
    }

    document.addEventListener("DOMContentLoaded", inicializarGraficos);
  </script>
</body>
</html>

