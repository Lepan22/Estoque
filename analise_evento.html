<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Detalhes do Evento</title>
  <link rel="stylesheet" href="assets/style.css">
  <link rel="stylesheet" href="assets/form-responsive.css">
</head>

<body>
  <div class="container">
    <h1>Detalhes do Evento</h1>
    <div id="eventoInfo"></div>

    <!-- Seção de Totais -->
    <div id="totaisEvento" style="margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
      <p><strong>Total de Vendas do Evento:</strong> <span id="totalVendasEvento">R$ 0,00</span></p>
      <p><strong>Total de Perda do Evento:</strong> <span id="totalPerdaEvento">R$ 0,00</span></p>
      <p><strong>Valor de Logística:</strong> <span id="valorLogistica">R$ 0,00</span></p>
      <p><strong>Valor de Equipe:</strong> <span id="valorEquipe">R$ 0,00</span></p>
    </div>

    <!-- Restante do seu código HTML permanece igual -->
    <!-- ... -->
  </div>

  <script type="module">
    // Configurações do Firebase e outras declarações permanecem iguais
    // ...

    async function carregarDados() {
      try {
        const [snapshotEvento, snapshotProdutos] = await Promise.all([
          get(refEvento),
          get(ref(db, "produtos"))
        ]);

        if (!snapshotEvento.exists()) {
          alert("Evento não encontrado.");
          window.location.href = "index.html";
          return;
        }

        eventoAtual = snapshotEvento.val();
        currentItens = Array.isArray(eventoAtual.itens) ? eventoAtual.itens : [];

        // CORREÇÃO: Tratamento adequado dos valores de logística e equipe
        const logistica = typeof eventoAtual.logistica === 'object' ? 
                         (eventoAtual.logistica.valor || eventoAtual.logistica.total || 0) : 
                         (eventoAtual.logistica || 0);
        
        const equipe = typeof eventoAtual.equipe === 'object' ? 
                      (eventoAtual.equipe.valor || eventoAtual.equipe.total || 0) : 
                      (eventoAtual.equipe || 0);

        // Preenche os valores formatados
        valorLogisticaEl.textContent = formatCurrency(parseFloat(logistica));
        valorEquipeEl.textContent = formatCurrency(parseFloat(equipe));

        // Restante da função permanece igual
        // ...
      } catch (err) {
        console.error("Erro ao buscar dados do evento e/ou produtos:", err);
        itensBody.innerHTML = `<tr><td colspan="7" data-label="Erro">Erro ao carregar itens. Verifique o console.</td></tr>`;
        atualizarTotaisGerais();
      }
    }

    // Restante do seu código JavaScript permanece igual
    // ...

    btnFinal.addEventListener("click", async () => {
      if (btnFinal.disabled) return; 
      
      btnFinal.disabled = true;
      btnFinal.textContent = "Processando...";
      btnSalvar.disabled = true;

      const itensAtualizados = coletarItensAtualizados(true);
      const totalVendasFinal = parseCurrency(totalVendasEventoEl.textContent);
      const totalPerdaFinal = parseCurrency(totalPerdaEventoEl.textContent);
      
      // CORREÇÃO: Obter os valores corretamente dos campos
      const valorLogistica = parseCurrency(valorLogisticaEl.textContent);
      const valorEquipe = parseCurrency(valorEquipeEl.textContent);

      try {
        await update(refEvento, { 
          itens: itensAtualizados, 
          status: "finalizado",
          totalVendasEvento: totalVendasFinal,
          totalPerdaEvento: totalPerdaFinal,
          logistica: valorLogistica,
          equipe: valorEquipe
        });
        
        // Restante do código do evento de clique permanece igual
        // ...
      } catch (err) {
        console.error("Erro ao finalizar evento:", err);
        alert("Falha ao finalizar o evento. Verifique o console para mais detalhes.");
        btnFinal.disabled = false;
        btnFinal.textContent = "Finalizar Evento e Salvar Alterações";
        if (eventoAtual.status !== "finalizado") {
            btnSalvar.disabled = false;
        }
      }
    });

    // Restante do seu código JavaScript permanece igual
    // ...

    carregarDados();
  </script>
</body>
</html>
