<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Detalhes do Evento</title>
  <link rel="stylesheet" href="assets/style.css">
  <link rel="stylesheet" href="assets/form-responsive.css">
</head>

<body>
  <div class="container">
    <h1>Detalhes do Evento</h1>
    <div id="eventoInfo"></div>

    <!-- Seção de Totais -->
    <div id="totaisEvento" style="margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
      <p><strong>Total de Vendas do Evento:</strong> <span id="totalVendasEvento">R$ 0,00</span></p>
      <p><strong>Total de Perda do Evento:</strong> <span id="totalPerdaEvento">R$ 0,00</span></p>
      <p><strong>Valor de Logística:</strong> <span id="valorLogistica">R$ 0,00</span></p>
      <p><strong>Valor de Equipe:</strong> <span id="valorEquipe">R$ 0,00</span></p>
    </div>

    <!-- Restante do seu HTML permanece igual -->
    <!-- ... -->
  </div>

  <script type="module">
    // Configurações do Firebase permanecem iguais
    // ...

    async function carregarDados() {
      try {
        const [snapshotEvento, snapshotProdutos] = await Promise.all([
          get(refEvento),
          get(ref(db, "produtos"))
        ]);

        if (!snapshotEvento.exists()) {
          alert("Evento não encontrado.");
          window.location.href = "index.html";
          return;
        }

        eventoAtual = snapshotEvento.val();
        currentItens = Array.isArray(eventoAtual.itens) ? eventoAtual.itens : [];

        // DEBUG: Verifique a estrutura completa do evento no console
        console.log("Dados completos do evento:", eventoAtual);

        // CORREÇÃO: Busca os valores corretos da estrutura do seu banco de dados
        const valorLogistica = eventoAtual.custos?.logistica || 
                             eventoAtual.logistica?.valor || 
                             eventoAtual.logistica || 0;
        
        const valorEquipe = eventoAtual.custos?.equipe || 
                          eventoAtual.equipe?.valor || 
                          eventoAtual.equipe || 0;

        console.log("Valores encontrados - Logística:", valorLogistica, "Equipe:", valorEquipe);

        // Preenche os valores formatados
        valorLogisticaEl.textContent = formatCurrency(parseFloat(valorLogistica));
        valorEquipeEl.textContent = formatCurrency(parseFloat(valorEquipe));

        // Restante da função permanece igual
        // ...

      } catch (err) {
        console.error("Erro ao buscar dados:", err);
        // Tratamento de erro permanece igual
      }
    }

    // Restante do seu código JavaScript permanece igual
    // ...

    btnFinal.addEventListener("click", async () => {
      // Código existente permanece igual até a parte de atualização
      
      try {
        await update(refEvento, { 
          // Campos existentes permanecem
          // ...
          
          // CORREÇÃO: Garante que os valores serão salvos como números
          logistica: parseFloat(parseCurrency(valorLogisticaEl.textContent)),
          equipe: parseFloat(parseCurrency(valorEquipeEl.textContent))
        });
        
        // Restante do código permanece igual
      } catch (err) {
        // Tratamento de erro permanece igual
      }
    });

    // Restante do seu código permanece igual
    // ...

    carregarDados();
  </script>
</body>
</html>
