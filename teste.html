const urlParams = new URLSearchParams(window.location.search);
const id = urlParams.get("id");
const db = firebase.database();

async function calcularCustosFixos() {
  try {
    const snap = await db.ref(`eventos/${id}`).get();
    const evento = snap.val();
    if (!evento || !evento.itens) {
      alert("Evento sem itens ou não encontrado.");
      return;
    }

    const itens = evento.itens;
    let totalLogistica = 0;
    let totalEquipe = 0;

    itens.forEach(item => {
      totalLogistica += parseFloat(item.logistica || 0);
      totalEquipe += parseFloat(item.equipe || 0);
    });

    // Salvar no banco
    await db.ref(`eventos/${id}/analise`).update({
      custoLogistica: totalLogistica,
      custoEquipe: totalEquipe
    });

    console.log("Custos salvos:", { totalLogistica, totalEquipe });
    alert("Custos de logística e equipe salvos com sucesso!");

  } catch (e) {
    console.error("Erro ao calcular e salvar custos:", e);
    alert("Erro ao salvar custos.");
  }
}

document.addEventListener("DOMContentLoaded", calcularCustosFixos);
