<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import {
    getDatabase,
    ref,
    push,
    set,
    get,
    onValue
  } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBN-bmzgrlzjmrKMmuClZ8LVll-vJyx-aE",
    authDomain: "controleestoquelepan.firebaseapp.com",
    databaseURL: "https://controleestoquelepan-default-rtdb.firebaseio.com",
    projectId: "controleestoquelepan",
    storageBucket: "controleestoquelepan.appspot.com",
    messagingSenderId: "779860276544",
    appId: "1:779860276544:web:f45844571a8c0bab1576a5",
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const form = document.getElementById('form-produto');
  const nomeInput = document.getElementById('nome');
  const valorVendaInput = document.getElementById('valorVenda');
  const custoInput = document.getElementById('custo');

  form.addEventListener('submit', async function(e) {
    e.preventDefault();

    const nome = nomeInput.value.trim();
    const valorVenda = parseFloat(valorVendaInput.value);
    const custo = parseFloat(custoInput.value);

    if (!nome || isNaN(valorVenda) || isNaN(custo)) {
      alert('Preencha todos os campos corretamente!');
      return;
    }

    const novoRef = push(ref(db, "produtos"));
    await set(novoRef, { nome, valorVenda, custo });

    form.reset();
    carregarProdutos();
  });

  function carregarProdutos() {
    const tabela = document.getElementById('produtos-tabela').getElementsByTagName('tbody')[0];
    const produtosRef = ref(db, "produtos");

    onValue(produtosRef, (snapshot) => {
      tabela.innerHTML = '';

      if (!snapshot.exists()) {
        const linha = tabela.insertRow();
        const celula = linha.insertCell(0);
        celula.colSpan = 3;
        celula.textContent = 'Nenhum produto cadastrado.';
        return;
      }

      const produtos = snapshot.val();

      Object.values(produtos).forEach(produto => {
        const linha = tabela.insertRow();
        linha.insertCell(0).textContent = produto.nome;
        linha.insertCell(1).textContent = parseFloat(produto.valorVenda).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        linha.insertCell(2).textContent = parseFloat(produto.custo).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
      });
    });
  }

  window.addEventListener('DOMContentLoaded', carregarProdutos);
</script>
