<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="form-title">Criar Evento</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="container">
    <h1 id="form-title">Criar Evento</h1>
    <form id="evento-form">
      <label for="nome">Nome do Evento:</label>
      <input type="text" id="nome" name="nome" required />

      <label for="data">Data:</label>
      <input type="date" id="data" name="data" required />

      <label for="local">Local:</label>
      <input type="text" id="local" name="local" required />

      <label for="cliente">Cliente:</label>
      <input type="text" id="cliente" name="cliente" required />

      <h3>Equipe</h3>
      <div class="equipe-item">
        <label for="equipe1">Pessoa 1 (R$):</label>
        <input type="number" id="equipe1" class="equipe" name="equipe1" min="0" step="0.01" />
      </div>
      <div class="equipe-item">
        <label for="equipe2">Pessoa 2 (R$):</label>
        <input type="number" id="equipe2" class="equipe" name="equipe2" min="0" step="0.01" />
      </div>

      <p><strong>Custo Equipe:</strong> R$ <span id="custo-equipe">0.00</span></p>

      <h3>Logística</h3>
      <div class="logistica-item">
        <label for="log1">Transporte (R$):</label>
        <input type="number" id="log1" class="logistica" name="log1" min="0" step="0.01" />
      </div>
      <div class="logistica-item">
        <label for="log2">Combustível (R$):</label>
        <input type="number" id="log2" class="logistica" name="log2" min="0" step="0.01" />
      </div>

      <p><strong>Custo Logística:</strong> R$ <span id="custo-logistica">0.00</span></p>

      <button type="submit" id="submit-button">Criar Evento</button>
    </form>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const eventoId = urlParams.get('id');
    const formTitle = document.getElementById('form-title');
    const submitButton = document.getElementById('submit-button');

    if (eventoId) {
      formTitle.textContent = 'Editar Evento';
      submitButton.textContent = 'Salvar Alterações';
      const eventos = JSON.parse(localStorage.getItem('eventos')) || [];
      const evento = eventos.find(e => e.id === eventoId);
      if (evento) {
        document.getElementById('nome').value = evento.nome;
        document.getElementById('data').value = evento.data;
        document.getElementById('local').value = evento.local;
        document.getElementById('cliente').value = evento.cliente;
        document.getElementById('equipe1').value = evento.equipe1 || '';
        document.getElementById('equipe2').value = evento.equipe2 || '';
        document.getElementById('log1').value = evento.log1 || '';
        document.getElementById('log2').value = evento.log2 || '';
        calcularTotais();
      }
    }

    function calcularTotais() {
      const somar = (classe) => {
        return Array.from(document.querySelectorAll('.' + classe)).reduce((total, input) => {
          const val = parseFloat(input.value);
          return total + (isNaN(val) ? 0 : val);
        }, 0);
      };
      document.getElementById('custo-equipe').textContent = somar('equipe').toFixed(2);
      document.getElementById('custo-logistica').textContent = somar('logistica').toFixed(2);
    }

    document.querySelectorAll('.equipe, .logistica').forEach(input => {
      input.addEventListener('input', calcularTotais);
    });

    document.getElementById('evento-form').addEventListener('submit', function (e) {
      e.preventDefault();

      const evento = {
        id: eventoId || Date.now().toString(),
        nome: document.getElementById('nome').value,
        data: document.getElementById('data').value,
        local: document.getElementById('local').value,
        cliente: document.getElementById('cliente').value,
        equipe1: parseFloat(document.getElementById('equipe1').value) || 0,
        equipe2: parseFloat(document.getElementById('equipe2').value) || 0,
        log1: parseFloat(document.getElementById('log1').value) || 0,
        log2: parseFloat(document.getElementById('log2').value) || 0
      };

      let eventos = JSON.parse(localStorage.getItem('eventos')) || [];

      if (eventoId) {
        const index = eventos.findIndex(e => e.id === eventoId);
        if (index !== -1) eventos[index] = evento;
      } else {
        eventos.push(evento);
      }

      localStorage.setItem('eventos', JSON.stringify(eventos));
      window.location.href = '../index.html';
    });
  </script>
</body>

</html>
